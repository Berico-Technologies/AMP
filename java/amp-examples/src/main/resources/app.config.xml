<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                      http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">


    <!-- Our BusTester GUI, which uses the Event Bus -->
    <bean id="busTester" class="amp.examples.gui.BusTester">
        <constructor-arg name="eventBus" ref="eventBus" />
    </bean>


    <!-- The following components are for our Event Bus, which uses our Envelope Bus -->
    <bean id="eventBus" class="amp.eventing.DefaultEventBus">
        <constructor-arg name="envelopeBus" ref="envelopeBus" />
        <constructor-arg name="inboundEventProcessors" ref="inboundEventProcessors" />
        <constructor-arg name="outboundEventProcessors" ref="outboundEventProcessors" />
    </bean>

    <util:list id="inboundEventProcessors" value-type="amp.eventing.IEventProcessor">
        <ref bean="rpcFilter" />
        <ref bean="serializationProcessor" />
    </util:list>

    <util:list id="outboundEventProcessors" value-type="amp.eventing.IEventProcessor">
        <ref bean="serializationProcessor" />
        <ref bean="outboundHeadersProcessor" />
        <ref bean="rpcFilter"/>
    </util:list>

    <bean id="serializationProcessor" class="amp.eventing.serializers.JsonEventSerializer">
        <constructor-arg name="serializer" ref="serializer" />
    </bean>

    <bean id="serializer" class="amp.eventing.GsonSerializer" />

    <bean id="outboundHeadersProcessor" class="amp.eventing.OutboundHeadersProcessor">
        <constructor-arg name="userInfoRepository" ref="userInfoRepository" />
    </bean>

    <bean id="userInfoRepository" class="amp.bus.security.InMemoryUserInfoRepository" />

    <bean id="rpcFilter" class="amp.eventing.RpcFilter" />


    <!-- The follow components are for our Envelope Bus -->
    <bean id="envelopeBus" class="amp.bus.DefaultEnvelopeBus">
        <constructor-arg name="transportProvider" ref="transportProvider" />
    </bean>

    <bean id="transportProvider" class="amp.bus.rabbit.RabbitTransportProvider">
        <constructor-arg name="topologyService" ref="topologyService" />
        <constructor-arg name="channelFactory" ref="channelFactory" />
    </bean>

    <bean id="channelFactory" class="amp.bus.rabbit.cmf.bus.berico.rabbit.ConnectionFactory">
        <property name="username" value="guest" />
        <property name="password" value="guest" />
        <property name="virtualHost" value="/" />
        <property name="host" value="localhost" />
        <property name="port" value="5672" />
    </bean>

    <bean id="topologyService" class="cmf.bus.berico.rabbit.support.InMemoryTopologyProvider">
        <constructor-arg name="profile" value="librarian" />
        <constructor-arg name="topologyRegistry" ref="topologyRegistry" />
    </bean>

    <bean id="topologyRegistry" class="cmf.bus.berico.rabbit.support.InMemoryTopologyRegistry">
        <constructor-arg name="receiveExchange" value="default" />
        <constructor-arg name="sendExchange" value="default" />
    </bean>

    <bean id="envelopeDispatcher" class="cmf.bus.berico.DefaultEnvelopeDispatcher" />



</beans>